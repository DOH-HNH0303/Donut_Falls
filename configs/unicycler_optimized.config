/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Unicycler-Optimized Configuration for Donut Falls
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Skip unnecessary processes when using Unicycler for hybrid assembly
    Combines with AWS optimizations for maximum cost savings
----------------------------------------------------------------------------------------
*/

// Include the AWS-optimized base config
includeConfig 'aws_optimized.config'

// Unicycler-specific parameters
params {
    assembler = 'unicycler'
}

process {
    // Skip processes that are not needed for unicycler
    withName:flye {
        ext.when = false
    }
    
    withName:raven {
        ext.when = false
    }
    
    withName:rasusa {
        ext.when = false
    }
    
    withName:fastplong {
        ext.when = false
    }
    
    // Skip dnaapler since unicycler handles orientation
    withName:dnaapler {
        ext.when = false
    }
    
    // Skip long-read polishing steps since unicycler does hybrid assembly
    withName:clair3 {
        ext.when = false
    }
    
    withName:bcftools {
        ext.when = false
    }
    
    withName:bwa {
        ext.when = false
    }
    
    withName:polypolish {
        ext.when = false
    }
    
    withName:pypolca {
        ext.when = false
    }

    // Optimize unicycler process for AWS
    withName:unicycler {
        cpus   = { 8 }
        memory = { 32.GB }
        time   = { 4.h }
        ext.args = '--mode conservative --min_fasta_length 200'
        machineType = 'c5.2xlarge'  // 8 vCPUs, 16 GB RAM - cost-effective
        disk = '100 GB'
    }

    // Keep essential QC and analysis processes with reduced resources
    withName:fastp {
        cpus   = { 2 }
        memory = { 4.GB }
        time   = { 20.m }
        machineType = 'm5.large'
        disk = '50 GB'
    }

    withName:mash {
        cpus   = { 2 }
        memory = { 4.GB }
        time   = { 10.m }
        machineType = 't3.medium'
        disk = '20 GB'
    }

    withName:circulocov {
        cpus   = { 4 }
        memory = { 16.GB }
        time   = { 20.m }
        machineType = 'm5.xlarge'
        disk = '100 GB'
    }

    withName:busco {
        cpus   = { 4 }
        memory = { 16.GB }
        time   = { 20.m }
        machineType = 'm5.xlarge'
        disk = '50 GB'
    }
}